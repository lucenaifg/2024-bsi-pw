<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exemplo de Cadastro de Usuário</title>
</head>

<script>

    function criarJsonUsuario(){
        //Copiar valor do input para formulario
        const nome = document.getElementById('nome').value;
        //Criar objeto JSON para submeter ao back-end
        const usuario = {
            nome: nome
        };
        // Limpa o formulário
        document.getElementById('userForm').reset();
        return usuario;
    }

    // Função para cadastrar usuário
    function salvarUsuario() {
        let usuario = criarJsonUsuario();
        fetch('/api/usuario/salvar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(usuario) //Convertendo objeto JSON em String
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Error ao criar objeto usuário');
            })
            .then(usuarioJSON => {
                console.log('Usuário criado:', usuarioJSON);
                atualizarLista(); // Atualiza a lista de usuários
            })
            .catch(error => console.error('Error:', error));
    }

    // Função para buscar usuários
    function atualizarLista() {
        fetch('/api/usuario/listar')
            .then(response => response.json())
            .then(usuarios => {
                const userList = document.getElementById('userList');
                userList.innerHTML = '';
                usuarios.forEach(usuario => {
                    const li = document.createElement('li');
                    li.textContent = 'Id: '+usuario.id+', Nome: '+usuario.nome;
                    userList.appendChild(li);
                });
            })
            .catch(error => console.error('Error fetching users:', error));
    }

    // Chama a função ao carregar a lista de usuários
    document.addEventListener('DOMContentLoaded', atualizarLista);

</script>
<body>

<h2>Cadastrar Novo Usuário</h2>
<form id="userForm">
    <label for="nome">Nome:</label>
    <input type="text" id="nome" name="nome" required>
    <button type="button" onclick="salvarUsuario()" >Cadastrar</button>
</form>

<h1>Lista de Usuários</h1>
<ul id="userList"></ul>

</body>
</html>